{% extends "base.html" %}
<!-- totals - необходим для подсчете итоговой суммы заказа
     ns - это счетчик, показывающий номер строки с товаром в таблице -->


{% block content %}

{% set totals = [] %}

<form method="POST">
<div class="row row-cols-1 row-cols-md-2 g-4">
    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th scope="col">Заказ</th>
                <th scope="col">№</th>
                <th scope="col">Фото</th>
                <th scope="col">Товар</th>
                <th scope="col">Цена </th>
                <th scope="col">Количество</th>
                <th scope="col">Стоимость</th>
                <th scope="col">Статус</th>
            </tr>
        </thead>

        <tbody>
        {% for order in orders %}
        {% set ns = namespace(c = 0) %}
            {% for line in order.line %}
            {% set ns.c = ns.c + 1 %}
            <tr>
                <td>{{ order.id }}</td>
                <td scope="row">{{ ns.c }}</td>
                <td width="10%"><img src="../static/{{ line.product.image.link }}"
                        class="img-fluid img-thumbnail max-width: auto; and height: 100%;"></a></td>
                <td>
                    <h6><a href="/product/{{ line.product.id }}" class="btn btn-secondary btn-sm">{{ line.product.name }}</a></h6>
                </td>
                <td>{{ '%0.0f' | format(line.total_cost) }} руб.</td>
                <td>{{ line.quantity }}</td>
                <td>{{ '%0.0f' | format(line.total_cost * line.quantity) }} руб.</td>
                <td>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <select class="custom-select" name="new_status.{{line.id}}" id="new_status">
                                <option selected>{{line.line_status[0].status.name}}</option>
                                {% for status in statuses %}
                                <option value={{status.id}}>{{status.id}} {{status.name}}</option>
                                {% endfor %}
                            </select>
                            <button class="btn btn-outline-secondary" type="submit">Изменить</button>
                        </div>
                    </div>
                </td>
            </tr><!-- END TR-->
            {% if totals.append(line.total_cost * line.quantity) %}{% endif %}

            {% endfor %}

        {% endfor %}
                    <tr>
                        <td colspan="6" align="right">Итого</td>
                        <td>{{ '%0.0f' | format(totals | sum) }} руб.</td>
                    </tr>
        </tbody>
    </table>
</div>
</form>

{% endblock %}